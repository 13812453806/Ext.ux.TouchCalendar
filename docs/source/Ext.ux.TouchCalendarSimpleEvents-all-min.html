<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&quot;Ext.ux.TouchCalendar&quot;,{extend:&quot;Ext.carousel.Carousel&quot;,xtype:&quot;calendar&quot;,enableSwipeNavigate:true,enableSimpleEvents:false,enableEventBars:false,viewConfig:{},defaultViewConfig:{viewMode:&quot;MONTH&quot;,weekStart:1,bubbleEvents:[&quot;selectionchange&quot;]},indicator:false,initialize:function(){this.viewConfig=Ext.applyIf(this.viewConfig||{},this.defaultViewConfig);this.viewConfig.currentDate=this.viewConfig.currentDate||this.viewConfig.value||new Date();this.viewMode=this.viewConfig.viewMode.toUpperCase();this.initViews();Ext.apply(this,{cls:&quot;touch-calendar&quot;,activeItem:(this.enableSwipeNavigate?1:0),direction:&quot;horizontal&quot;});this.setIndicator(false);this.setActiveItem(1);this.on(&quot;selectionchange&quot;,this.onSelectionChange);this.on(&quot;activeitemchange&quot;,this.onActiveItemChange);if(this.enableSwipeNavigate){this.on(this.element,{drag:this.onDrag,dragThreshold:5,dragend:this.onDragEnd,direction:this.direction,scope:this});this.element.addCls(this.baseCls+&quot;-&quot;+this.direction)}},getViewConfig:function(b){var a=[];if(this.enableSimpleEvents){a.push(new Ext.ux.TouchCalendarSimpleEvents())}else{if(this.enableEventBars){a.push(new Ext.ux.TouchCalendarEvents())}}Ext.apply(this.viewConfig,{plugins:a,currentDate:b,onTableHeaderTap:Ext.bind(this.onTableHeaderTap,this)});return this.viewConfig},getViewDate:function(a,b){var d=(this.viewMode===&quot;WEEK&quot;?&quot;DAY&quot;:this.viewMode.toUpperCase()),c=(this.viewMode===&quot;WEEK&quot;?(8*b):b);return Ext.Date.add(a,Ext.Date[d],c)},initViews:function(){var c=[];var f=Ext.Date.clone(this.viewConfig.currentDate),d=(this.enableSwipeNavigate?-1:0),a=(this.enableSwipeNavigate?1:0),b=[];var e=this.getViewDate(f,-1);c.push(new Ext.ux.TouchCalendarView(Ext.applyIf({currentDate:e},this.getViewConfig(e))));c.push(new Ext.ux.TouchCalendarView(this.getViewConfig(f)));e=this.getViewDate(f,1);c.push(new Ext.ux.TouchCalendarView(Ext.applyIf({currentDate:e},this.getViewConfig(e))));this.setItems(c);this.view=c[(this.enableSwipeNavigate?1:0)]},onTableHeaderTap:function(b,a){a=Ext.fly(a);if(a.hasCls(this.view.prevPeriodCls)||a.hasCls(this.view.nextPeriodCls)){this[(a.hasCls(this.view.prevPeriodCls)?&quot;prev&quot;:&quot;next&quot;)]()}},setMode:function(a){this.viewMode=a.toUpperCase();this.viewConfig.viewMode=this.viewMode;this.getItems().each(function(b,c){b.currentDate=this.getViewDate(Ext.Date.clone(this.view.currentDate),c-1);b.setViewMode(a,true);b.refresh()},this)},getValue:function(){var a=this.view.getSelectionModel().selected;return(a.getCount()&gt;0)?a.first().get(&quot;date&quot;):null},setValue:function(a){this.view.setValue(a)},onActiveItemChange:function(b,a,f){if(this.enableSwipeNavigate){var c=this.getItems();var e=c.indexOf(a),h=c.indexOf(f),g=(e&gt;h)?&quot;forward&quot;:&quot;backward&quot;;this.counter=(this.counter||0)+1;if(g===&quot;forward&quot;){this.remove(c.get(0));var d=new Ext.ux.TouchCalendarView(this.getViewConfig(Ext.Date.add(a.currentDate,Ext.Date[this.viewMode],1)));this.add(d)}else{this.remove(c.get(c.getCount()-1));var d=new Ext.ux.TouchCalendarView(this.getViewConfig(Ext.Date.add(a.currentDate,Ext.Date[this.viewMode],-1)));this.insert(0,d)}this.view=a}}});Ext.define(&quot;Ext.ux.TouchCalendarSimpleEvents&quot;,{extend:&quot;Ext.mixin.Observable&quot;,startEventField:&quot;start&quot;,endEventField:&quot;end&quot;,multiEventDots:true,wrapperCls:&quot;simple-event-wrapper&quot;,eventDotCls:&quot;simple-event&quot;,dotWidth:6,eventTpl:['&lt;span class=&quot;{wrapperCls}&quot;&gt;','&lt;tpl for=&quot;events&quot;&gt;','&lt;span class=&quot;{[parent.eventDotCls]}&quot;&gt;&lt;/span&gt;',&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/span&gt;&quot;].join(&quot;&quot;),filterFn:function(c,e,b){if(arguments.length===2){b=e}var a=Ext.Date.clearTime(c.get(this.startEventField),true).getTime(),d=Ext.Date.clearTime(c.get(this.endEventField),true).getTime(),b=Ext.Date.clearTime(b,true).getTime();return(a&lt;=b)&amp;&amp;(d&gt;=b)},init:function(a){this.calendar=a;this.calendar.simpleEventsPlugin=this;this.wrapperCls=this.wrapperCls+(this.multiEventDots?&quot;-multi&quot;:&quot;&quot;);this.eventDotCls=this.eventDotCls+(this.multiEventDots?&quot;-multi&quot;:&quot;&quot;);this.calendar.showEvents=this.showEvents;this.calendar.hideEvents=this.hideEvents;this.calendar.removeEvents=this.removeEvents;this.calendar.refresh=Ext.Function.createSequence(this.calendar.refresh,this.refreshEvents,this);this.calendar.syncHeight=Ext.Function.createSequence(this.calendar.syncHeight,this.refreshEvents,this)},refreshEvents:function(){if(!this.disabled){var a=this.calendar.getStore();if(a){this.removeEvents();a.each(function(d){var f=d.get(&quot;date&quot;);var c=this.calendar.getDateCell(f);var e=this.calendar.eventStore;if(c){e.clearFilter();var b=e[this.multiEventDots?&quot;filterBy&quot;:&quot;findBy&quot;](Ext.bind(this.filterFn,this,[f],true));var i=e.getRange().length;if((!this.multiEventDots&amp;&amp;b&gt;-1)||(this.multiEventDots&amp;&amp;i&gt;0)){var h=Math.min((c.getWidth()/this.dotWidth),i);var g=new Ext.XTemplate(this.eventTpl).append(c,{events:(this.multiEventDots?e.getRange().slice(0,h):[&quot;event&quot;]),wrapperCls:this.wrapperCls,eventDotCls:this.eventDotCls},true);g.setWidth(Math.min((this.multiEventDots?e.getRange().length:1)*this.dotWidth,c.getWidth()));g.setY((c.getY()+c.getHeight())-(g.getHeight()+(c.getHeight()*0.1)));g.setX((c.getX()+(c.getWidth()/2))-(g.getWidth()/2)+2)}}},this)}}},hideEvents:function(){this.simpleEventsPlugin.disabled=true;this.calendar.element.select(&quot;span.&quot;+this.wrapperCls).hide()},showEvents:function(){this.simpleEventsPlugin.disabled=false;this.calendar.element.select(&quot;span.&quot;+this.wrapperCls).show()},removeEvents:function(){if(this.calendar.element){this.calendar.element.select(&quot;span.&quot;+this.wrapperCls).remove()}}});</pre>
</body>
</html>
