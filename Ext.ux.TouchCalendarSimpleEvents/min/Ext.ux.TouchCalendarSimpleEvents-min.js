Ext.ux.TouchCalendarSimpleEvents=Ext.extend(Ext.util.Observable,{startEventField:"start",endEventField:"end",multiEventDots:true,wrapperCls:"simple-event-wrapper",eventDotCls:"simple-event",dotWidth:6,eventTpl:new Ext.XTemplate('<span class="{wrapperCls}">','<tpl for="events">','<span class="{[parent.eventDotCls]}"></span>',"</tpl>","</span>"),filterFn:function(c,e,b){var a=c.get(this.startEventField).clearTime(true).getTime(),d=c.get(this.endEventField).clearTime(true).getTime(),b=b.clearTime(true).getTime();return(a<=b)&&(d>=b)},init:function(a){this.calendar=a;this.calendar.simpleEventsPlugin=this;this.wrapperCls=this.wrapperCls+(this.multiEventDots?"-multi":"");this.eventDotCls=this.eventDotCls+(this.multiEventDots?"-multi":"");this.calendar.showEvents=this.showEvents;this.calendar.hideEvents=this.hideEvents;this.calendar.removeEvents=this.removeEvents;this.calendar.syncHeight=Ext.createSequence(this.calendar.syncHeight,this.refreshEvents,this)},refreshEvents:function(){if(!this.disabled){var a=this.calendar.store;if(a&&this.calendar.isVisible()){this.removeEvents();a.each(function(d){var f=d.get("date");var c=this.calendar.getDateCell(f);var e=this.calendar.eventStore;if(c){e.clearFilter();var b=e[this.multiEventDots?"filterBy":"findBy"](Ext.createDelegate(this.filterFn,this,[f],true));var i=e.getRange().length;if((!this.multiEventDots&&b>-1)||(this.multiEventDots&&i>0)){var h=Math.min((c.getWidth()/this.dotWidth),i);var g=this.eventTpl.append(c,{events:(this.multiEventDots?e.getRange().slice(0,h):["event"]),wrapperCls:this.wrapperCls,eventDotCls:this.eventDotCls},true);g.setWidth(Math.min((this.multiEventDots?e.getRange().length:1)*this.dotWidth,c.getWidth()));g.setY((c.getY()+c.getHeight())-(g.getHeight()+(c.getHeight()*0.1)));g.setX((c.getX()+(c.getWidth()/2))-(g.getWidth()/2))}}},this)}}},hideEvents:function(){this.simpleEventsPlugin.disabled=true;this.calendar.el.select("span."+this.wrapperCls).hide()},showEvents:function(){this.simpleEventsPlugin.disabled=false;this.calendar.el.select("span."+this.wrapperCls).show()},removeEvents:function(){if(this.calendar.el){this.calendar.el.select("span."+this.wrapperCls).remove()}}});